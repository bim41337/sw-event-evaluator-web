<html  
    xmlns = "http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui = "http://xmlns.jcp.org/jsf/facelets">

    <ui:composition template="./WEB-INF/templates/page-template.xhtml">

        <ui:define name="title">Auswertungen</ui:define>
        <ui:define name="activeItem">auswertungItem</ui:define>

        <ui:define name="page-content">

            <h3 class="ui dividing header">
                Auswertungen
                <div class="sub header">#{userBean.benutzer.name}</div>
            </h3>

            <div class="ui two column grid">
                <div class="ten wide column">
                    <h:form styleClass="ui form">
                        <div class="fields">
                            <div class="field">
                                <label>Von</label>
                                <h:inputText value="#{auswertungenBean.zeitraumStart}">
                                    <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Europe/Berlin"/>
                                    <f:passThroughAttribute name="type" value="date" />
                                </h:inputText>
                            </div>
                            <div class="field">
                                <label>Bis</label>
                                <h:inputText value="#{auswertungenBean.zeitraumEnde}">
                                    <f:convertDateTime pattern="yyyy-MM-dd" timeZone="Europe/Berlin"/>
                                    <f:passThroughAttribute name="type" value="date" />
                                </h:inputText>
                            </div>
                        </div>
                        <div class="field">
                            <h:commandLink styleClass="ui large green label" action="#{auswertungenBean.zeitraumAuswerten()}">
                                <i class="line chart icon"></i>
                                Zeitraum auswerten
                            </h:commandLink>
                        </div>
                    </h:form>
                </div>
                <div class="six wide column">
                    <h:form styleClass="ui form">
                        <div class="field">
                            <label>Auswertung anzeigen:</label>
                            <h:selectOneMenu styleClass="ui dropdown" value="#{auswertungenBean.gewaehlteAuswertung}">
                                <f:converter binding="#{auswertungenBean.auswertungenConverter}" />
                                <f:selectItems value="#{auswertungenBean.auswertungenList}" />
                            </h:selectOneMenu>
                        </div>
                        <div class="field">
                            <h:commandLink styleClass="ui large label" action="#{auswertungenBean.auswertungAnzeigen()}" value="Auswertung anzeigen" />
                        </div>
                    </h:form>
                </div>
            </div>

            <ui:fragment rendered="#{not empty auswertungenBean.gewaehlteAuswertung}">
                <h4 class="ui horizontal divider header">
                    <i class="line chart icon"></i>
                    Auswertungsdaten
                </h4>

                <table class="ui celled table">
                    <thead>
                        <tr>
                            <th class="four wide">
                                <h:form>
                                    <h:commandButton styleClass="ui blue button" value="Speichern" action="#{auswertungenBean.speichernAuswertung()}" />
                                    <ui:fragment rendered="#{not empty auswertungenBean.gewaehlteAuswertung.id}">
                                        <h:commandButton styleClass="ui red button" value="Löschen" action="#{auswertungenBean.loeschenAuswertung()}" />
                                    </ui:fragment>
                                </h:form>
                            </th>
                            <th class="twelve wide">#{auswertungenBean.gewaehlteAuswertung.zeitraumFormated}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Anzahl Einträge</td>
                            <td>#{auswertungenBean.gewaehlteAuswertung.posten.size()}</td>
                        </tr>
                        <tr>
                            <td>Bewertungsdurchschnitt</td>
                            <td>
                                <h:outputText value="#{auswertungenBean.gewaehlteAuswertung.durchschnitt}">
                                    <f:convertNumber pattern="0.0" />
                                </h:outputText>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="ui center aligned grid">
                    <div class="column">
                        <div id="auswertungChartContainer"></div>
                    </div>
                </div>

                <script type="text/javascript">
                    const chartOptions = {
                        tooltip: {enabled: false},
                        title: {text: 'Bewertungen', fontColor: 'black'},
                        axisY: {
                            tickThickness: 0,
                            lineThickness: 0,
                            valueFormatString: ' ',
                            gridThickness: 0
                        },
                        axisX: {
                            tickThickness: 0,
                            lineThickness: 0,
                            gridThickness: 0
                        },
                        data: [{
                                indexLabelPlacement: 'inside',
                                indexLabelFontColor: 'white',
                                indexLabelFontWeight: 600,
                                color: 'darkgrey',
                                type: 'bar',
                                dataPoints: [
                    #{auswertungenBean.postenChartDatenString}
                                ]
                            }]
                    };
                    $('#auswertungChartContainer').CanvasJSChart(chartOptions);
                </script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/canvasjs/1.7.0/canvasjs.min.js"></script>
            </ui:fragment>

        </ui:define>

    </ui:composition>

</html>